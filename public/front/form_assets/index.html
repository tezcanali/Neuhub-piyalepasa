
<!DOCTYPE html>
<html lang="tr" >
<head lang="tr">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adflex</title>
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
    <script type="text/javascript" src="jquery-1.12.0.min.js"></script>
    <script type="text/javascript" src="bootstrap.min.js"></script>
    <script src="cc-picker/js/jquery.ccpicker.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="cc-picker/css/jquery.ccpicker.css">
    <link rel="stylesheet" type="text/css" href="style.css">
<body>
    <div class="overlay" id="success_message" style="display:none;">
        <div class="alert alert-info fade in" role="alert">
            <h4>Teşekkürler</h4>
            <p>İletişim Bilgileriniz İletildi.</p>
        </div>
    </div>
<div class="overlay" id="dogrulama" style="display:none;">
        <div class="alert alert-info fade in" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Kapat">
                <span aria-hidden="true">×</span>
            </button>
            <h4>SMS Doğrulama</h4>
            <div class="dogrulama" >
                <form action="/kod_onay" method="POST" id="onayform">
                    <p>Formun iletilebilmesi için telefonunuza gelen doğrulama kodunu giriniz.</p>
                    <div class="center-content">
                        <input class="form-control" id="kod" type="number" name="kod" />
                    </div>
                	<input type="hidden" name="isim" id="isim" value=""/>
                	<input type="hidden" name="email" id="email" value=""/>
                    <input type="hidden" name="telefon" id="telefon" value=""/>
                    <input type="hidden" name="dataId" id="dataId" value=""/>
                    <div class="button-wrapper center-content">
                        <button id="form_onay" type="submit" class="btn">GÖNDER</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
     <div class="container">
        <form action="" method="post" class="sendFormData" id="adflex_form_id_31">
			<div class="form-group">
                <input type="text"  name="input_1" class="form-control" id="input_1"  placeholder="Adınız Soyadınız" required>
            </div>
            <div class="form-group">
                <input type="number"  name="input_2" class="form-control" id="input_2"  placeholder="Telefon Numaranız" required style="display:inline-block;width:calc(80% - 5px);">
                <script>$("#input_2").CcPicker({"countryCode": "tr"});</script>
            </div>
            <div class="form-group">
                <input type="email"  id="input_3"  name="input_3" class="form-control" placeholder="E-Mail Adresiniz" required>
            </div>
            <div class="form-group">
                <textarea  id="input_5"  name="input_5" class="form-control" placeholder="Mesajınız" required></textarea>
            </div>
            <div class="form-group">
                <label class="checkbox-inline">
                    <input type="checkbox" class="input_4" name="input_4[]" value="AB Vatandaşıyım"/> AB Vatandaşıyım
                </label>
            </div>
            <div class="checkbox center-content">
                    <label>
                        <input type="checkbox" class="checkbox-form" checked required> <span style="font-family: arial, helvetica, sans-serif; color: #000000;">&ldquo;<a style="color: #000000; text-decoration: underline;" href="https://www.piyalepasa.com.tr/lp/kvk_yeni.html" target="_blank" rel="noopener">Aydınlatma metni</a>&rdquo; ve &ldquo;<span style="text-decoration: underline;"><a style="color: #000000; text-decoration: underline;" href="https://www.piyalepasa.com.tr/lp/acik_riza.html" target="_blank" rel="noopener">A&ccedil;ık Rıza Beyanını</a></span>&rdquo;&nbsp; okudum kabul ediyorum.</span>
                    </label>
                </div>
                <div class="button-wrapper center-content">
                    <button id="form_button" type="submit" class="btn">GÖNDER</button>
                </div>
		</form>
    </div>

    <div class="message" id="message">
        <div class="message-text"><p><p><span style="font-family: arial, helvetica, sans-serif; color: #000000;">&ldquo;<a style="color: #000000; text-decoration: underline;" href="https://www.piyalepasa.com.tr/lp/kvk_yeni.html" target="_blank" rel="noopener">Aydınlatma metni</a>&rdquo; ve &ldquo;<span style="text-decoration: underline;"><a style="color: #000000; text-decoration: underline;" href="https://piyalepasa.com.tr/lp/acik_riza.html" target="_blank" rel="noopener">A&ccedil;ık Rıza Beyanını</a></span>&rdquo;&nbsp; okudum kabul ediyorum.</span></p></p></div>
        <a href="javascript:;" id="close">KAPAT</a>
    </div>

    <script type="text/javascript">
        $('.close').on('click', function () {
            $('.overlay').hide();
        });
        function MailKontrol(email) {
    var pattern = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
    return pattern.test(email);
}
		 $("#form_button").click(function(es){
            es.preventDefault();
            $('.error').removeClass('error');
            var telefon = jQuery('#input_2_phoneCode').val()+jQuery('#input_2').val();
            var isim = jQuery('#input_1').val();
            var email = jQuery('#input_3').val();
            var collector_id = 'jd0nu88p';

            if(!isim){
                jQuery('#input_1').addClass('error');
            }

            if(!MailKontrol(email)){
                jQuery('#input_3').addClass('error');
            }
            if(telefon.length < 5){
                jQuery('#input_2').addClass('error');
            }

            if($('.error').length > 0){
                return;
            }

            $.ajax({
                url: 'https://www.piyalepasa.com.tr/api/formAccessStatus.php',
                type: 'GET',
                data: {phoneNumber: telefon,email:email,name:isim,collector_id:collector_id},
                error: function() {
                     alert('Bir hata oluştu tekrar deneyiniz.');
                },
                success: function(data) {
                    if(data.status === true){
                        $('.sendFormData').submit();
                    }else if(data.status === false && data.dataId){
                        $('#telefon').val(telefon);
                        $('#isim').val(isim);
                        $('#email').val(email);
                        $('#dataId').val(data.dataId);
                        $('#dogrulama').show();
                        return false;
                    }else{
                        alert('Telefon numarası hatalı. Lütfen tekrar deneyiniz.');
                        return false;
                    }
                }
            });

            return false;
        });

         $('.sendFormData').submit(function(e) {
            e.preventDefault();
            $.ajax({
                url: 'https://www.piyalepasa.com.tr/api/sendCrm.php',
                type: 'GET',
                data: $('.sendFormData').serialize(),
                error: function() {
                    alert('Bir hata oluştu tekrar deneyiniz.');
                },
                success: function(data) {
                    if(data.status === true){
                        $('.overlay').hide();
                        $('#success_message').show();
                    }else{
                        alert("Bilgileriniz İletilemedi.")
                    }
                }
            });
        });

        $('#onayform').submit(function(e) {
            e.preventDefault();
            var telefon = jQuery('#input_2_phoneCode').val()+jQuery('#input_2').val();
            var isim = jQuery('#input_1').val();
            var email = jQuery('#input_3').val();
            var dogrulama = $('#kod').val();
            var dataId = $('#dataId').val();

            $.ajax({
                url: 'https://www.piyalepasa.com.tr/api/verifyCode.php',
                type: 'GET',
                data: {phone: telefon,code:dogrulama,dataId:dataId},
                error: function() {
                    alert('Bir hata oluştu tekrar deneyiniz.');
                },
                success: function(data) {
                    if(data.status === true){
                        $('.sendFormData').submit();
                    }
                    else{
                        alert("Doğrulama kodu yanlış tekrar deneyiniz.")
                    }
                }
            });

            return false;
        });

        function isNumberKey(evt)
        {
            var charCode = (evt.which) ? evt.which : event.keyCode
        	if (charCode > 31 && (charCode < 48 || charCode > 57))
                  return false;
                 return true;
        } 

        $("input[type=number]").keypress(function (e) {

            var maxlengthNumber = parseInt($(this).attr('maxlength'));
            var inputValueLength = $(this).val().length + 1;
            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {

                return false;
            }
            if (maxlengthNumber < inputValueLength) {
                return false;
            }
        });

        $("input[type=email]").keypress(function (e) {

            var maxlengthNumber = parseInt($(this).attr('maxlength'));
            var inputValueLength = $(this).val().length + 1;
            if (maxlengthNumber < inputValueLength) {
                return false;
            }
        });

    </script>

</body>
</html>
